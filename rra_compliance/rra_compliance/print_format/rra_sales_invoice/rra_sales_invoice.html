<div style="font-family: Arial, sans-serif; font-size: 12px; color: #000;">
  <!-- Header -->
  <div style="border-bottom: 1px solid #000; padding-bottom: 10px;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      {% if company.company_logo %}
        <img src="{{ company.company_logo }}" style="height: 45px;">
      {% endif %}
      <img src="/assets/rra_compliance/images/Rwanda-Revenue-Authority-logo-1.webp" style="width: 50px;">
    </div>
    <h4 style="text-align: left; margin: 4px 0;">{{ company.name }}</h4>
    <p style="text-align: left; margin: 0;">{{ company_address or 'Please set a company address' }}</p>
    <p style="text-align: left; margin: 0;">{{ ('Tel: ' ~ company.phone_no) if company.phone_no else "" }}</p>
    <p style="text-align: left; margin: 0;">{{ ('Email: ' ~ company.email) if company.email else "" }}</p>
    <p style="text-align: left; margin: 0;">TIN: {{ company.tax_id }}</p>
  </div>

  <!-- Invoice To and No/Date -->
  <div style="display: flex; justify-content: space-between; margin-top: 10px;">
    <div>
      <h4 style="margin: 0;">INVOICE TO</h4>
      <p style="margin: 2px 0;"> {{ ('<strong>TIN :</strong>' ~ customer_tax_id) if customer_tax_id else '' }}</p>
      <p style="margin: 2px 0;"><strong>Name :</strong> {{ customer }}</p>
    </div>
    <div style="text-align: right;">
      <h4 style="margin: 0;">INVOICE NO : {{ doc.name }}</h4>
      <p style="margin: 2px 0;"><strong>Date :</strong> {{ frappe.utils.format_date(doc.posting_date, "dd-MM-yyyy") }}</p>
    </div>
  </div>

  <!-- Items Table -->
  <div style="margin-top: 10px; border-top: 1px solid #000; border-bottom: 1px solid #000; min-height: 500px">
    <div style="display: grid; grid-template-columns: 120px 1fr 40px 40px 80px 100px; padding: 3px 0; font-weight: bold;">
      <div>Item Code</div>
      <div>Item Description</div>
      <div style="text-align: right;">Qty</div>
      <div style="text-align: right;">Unit Price</div>
      <div style="text-align: right;">Total Price</div>
      <div style="text-align: right;">Tax</div>
    </div>
    {% for item in doc.items %}
    <div style="display: grid; grid-template-columns: 120px 1fr 40px 40px 80px 100px; border-top: 0.5px dotted #ccc; padding: 3px 0;">
      <div>{{ item.item_code }}</div>
      <div>{{ item.item_name }}</div>
      <div style="text-align: right;">{{ item.qty | int }}</div>
      <div style="text-align: right;">{{ "{:,.0f}".format(item.rate) }}</div>
      <div style="text-align: right;">{{ "{:,.0f}".format(item.amount) }}</div>
      <div style="text-align: right;">{{ item.item_tax_template.split(' - ')[0] }}</div>
    </div>
    {% endfor %}
  </div>

  <!-- SDC Information -->
  {% if rra %}
  <div style="border-top: 2px solid #000; margin-top: 20px; padding-top: 10px; display: flex; justify-content: space-between;">
    <div style="flex: 2;">
      <h4 style="margin: 0;">SDC INFORMATION</h4>
      <p style="margin: 2px 0;"><strong>Date :</strong> {{ frappe.utils.format_date(doc.posting_date, "dd-MM-yyyy") }} <strong>Time :</strong> {{ frappe.utils.format_time(doc.posting_time, "HH:mm:ss") }}</p>
      <p style="margin: 2px 0;"><strong>SDC ID :</strong> {{ rra.sdc_id or "" }}</p>
      <p style="margin: 2px 0;"><strong>Receipt Number :</strong> {{ rra.rcpt_no or "" }}</p>
      <p style="margin: 2px 0;"><strong>Internal Data :</strong> {{ rra.intrl_data or "" | batch(4) | map('join') | join('/') }}</p>
      <p style="margin: 2px 0;"><strong>MRC :</strong> {{ rra.mrc_number or rra.mrc_no or "" }}</p>
    </div>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data={{ qr_data | urlencode }}" width="120" height="120" style="margin-top: 10px;">
    <div style="flex: 1; text-align: right;">
      <p style="margin: 2px 0;"><strong>Total Rwf</strong> {{ log.totAmt }}</p>
      {% for code, amount in tax_groups.items() %}
      <p style="margin: 2px 0;"><strong>Total {{ code }}</strong> {{ "{:,.2f}".format(amount) }}</p>
      {% endfor %}
      <p style="margin: 2px 0;"><strong>Total Tax B</strong> {{ "{:,.2f}".format(tax_groups.get('B-18.00%', 0)) }}</p>
      <p style="margin: 2px 0;"><strong>Total Tax</strong> {{ log.totTaxAmt }}</p>
    </div>
  </div>
  {% if rra.printed_count and rra.printed_count > 1 %}
  <p style="color: red; font-weight: bold; text-align: center; margin-top: 5px;">DUPLICATE COPY</p>
  {% endif %}
  {% endif %}

  <!-- Footer -->
  <div style="text-align: center; margin-top: 15px; font-size: 11px; border-top: 1px solid #000; padding-top: 5px;">
    <p>Powered by EBM v2</p>
  </div>
</div>
